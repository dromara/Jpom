---
title: DSL é¡¹ç›®æ¥å£æ¢æ´»ç›‘æ§æŠ¥è­¦
date: 2022-10-21 13:20:47
permalink: /pages/610387/
categories:
  - docs
  - å®è·µæ¡ˆä¾‹
  - é¡¹ç›®ç›‘æ§
tags:
  - 
---

## å‰è¨€

Jpom ä¸­çš„é¡¹ç›®ç›‘æ§æ˜¯åˆ¤æ–­é¡¹ç›®çš„è¿è¡ŒçŠ¶æ€ï¼Œé¡¹ç›®çš„é DSL æ¨¡å¼çš„è¿è¡ŒçŠ¶æ€åˆæ˜¯é€šè¿‡ jps æŸ¥æ‰¾è¿›ç¨‹ id æ¥åˆ¤æ–­é¡¹ç›®æ˜¯å¦åœ¨è¿è¡Œä¸­ï¼Œè¿™æ ·åœ¨ä¸€äº›é¡¹ç›®å‡æ­»çš„æƒ…å†µæ˜¯æ— æ³•ç›‘æ§åˆ°çš„

ä½†æ˜¯å¦‚ä½•èƒ½ç›‘æ§åˆ°é¡¹ç›®çš„å‡æ­»çŠ¶æ€ï¼ˆå‡æ­»ä¸€èˆ¬æ˜¯ CPU æ»¡äº†ï¼Œé¡¹ç›®æ— æ³•æ­£å¸¸å“åº”å¤„ç†å…¶ä»–ä»»åŠ¡ã€æ­»é”ç­‰ï¼‰ï¼Œä¸€èˆ¬é¡¹ç›®éƒ½å¯ä»¥é€šè¿‡æ˜¯å¦èƒ½æ­£å¸¸è®¿é—®åˆ°æ¥å£æ¥åˆ¤æ–­å½“å‰é¡¹ç›®çš„çŠ¶æ€æˆ–è€…é¡¹ç›®çš„è´Ÿè½½æƒ…å†µï¼Œä»¥åŠæ¥å£é‡Œé¢å¯ä»¥è‡ªåŠ¨åˆ¤æ–­æ¡ä»¶æ¥å†³å®šé¡¹ç›®çŠ¶æ€

::: tip
æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚æœä½¿ç”¨ DSL æ¨¡å¼çš„é¡¹ç›®æ¥å®ç°æ¥å£æ¢æ´»ç®¡ç†é¡¹ç›®è¿è¡ŒçŠ¶æ€å¹¶ä¸”ç›‘æ§åˆ°å¼‚å¸¸å‘é€é‚®ä»¶é€šçŸ¥
:::

::: danger ğŸ˜‹
æœ¬æ–‡æ˜¯åŸºäº[`DSLé¡¹ç›®æ¥å£æ¢æ´»`](/pages/ac7b66/)å®è·µæ¡ˆä¾‹æ¥ä»‹ç»ï¼ŒæŸ¥çœ‹å½“å‰æ¡ˆä¾‹å‰è¯·æŸ¥é˜… [DSLé¡¹ç›®æ¥å£æ¢æ´»](/pages/ac7b66/) æ¡ˆä¾‹
:::


## éœ€è¦å‡†å¤‡çš„ç¯å¢ƒ

1. Jpom æœåŠ¡ç«¯
	1. å®‰è£… jpom éœ€è¦ java ç¯å¢ƒ
	2. æ„å»ºéœ€è¦ maven ç¯å¢ƒ
2. Jpom æ’ä»¶ç«¯
	1. å®‰è£… jpom éœ€è¦ java ç¯å¢ƒ
3. ä¸€ä¸ªä»£ç ä»“åº“ï¼ˆæ¡ˆä¾‹ä¸­ä½¿ç”¨ java é¡¹ç›®ï¼‰
4. ä¸€ä¸ªé‚®ä»¶å‘é€è´¦å·

## é¡¹ç›®çš„åˆå§‹åŒ–é…ç½®

é…ç½®ç»†èŠ‚è¯·å‚è€ƒï¼š[DSLé¡¹ç›®æ¥å£æ¢æ´»](/pages/ac7b66/)

### DSL è„šæœ¬ç¤ºä¾‹

```shell
#!/bin/bash
Tag="Application_${PROJECT_ID}"
MainClass="org.springframework.boot.loader.JarLauncher"
Lib="${PROJECT_PATH}"
Log="${PROJECT_PATH}/run.log"
JVM="-server -Xms128m -Xmx128m -XX:PermSize=32M -XX:MaxNewSize=64m -XX:MaxPermSize=64m -Djava.awt.headless=true -XX:+CMSClassUnloadingEnabled -XX:+CMSPermGenSweepingEnabled"

TestUrl="http://127.0.0.1:8084/random-sleep?max=3"
echo $Tag
RETVAL="0"

# See how we were called.
function start() {
 	# å…ˆåœæ­¢
    stop
    echo  $Log 
    if [ ! -f $Log ]; then
        touch $Log
    fi
    nohup java $JVM -Dappliction=$Tag -Djava.ext.dirs=$Lib":${JAVA_HOME}/jre/lib/ext" $MainClass > $Log 2>&1 &
	sleep 3
    head -n 10 $Log
}


function stop() {
    pid=$(ps -ef | grep -v 'grep' | egrep $Tag| awk '{printf $2 " "}')
    if [ "$pid" != "" ]; then      
        echo -n "boot ( pid $pid) is running" 
        echo 
        echo -n $"Shutting down boot: "
        pid=$(ps -ef | grep -v 'grep' | egrep $Tag| awk '{printf $2 " "}')
        if [ "$pid" != "" ]; then
            echo "kill boot process"
            kill -9 "$pid"
        fi
        else 
             echo "boot is stopped" 
        fi

    status
}

function get_json_value()
{
  local json=$1
  local key=$2
  local value=$(echo "${json}" | awk -F "[{,:}]" '{for(i=1;i<=NF;i++){if($i~"'${key}'"){print $(i+1)}}}' | sed 's/\"//g') 
  echo ${value}
}

function status()
{
   #  è¿™é‡Œçš„ç«¯å£æˆ–è€…url è·¯å¾„éœ€è¦è·Ÿè¿›ä½ çš„é¡¹ç›®ç«¯å£å’Œè·å–é¡¹ç›®çŠ¶æ€çš„æ¥å£æ¥å®š
    result_msg=$(curl -s -X GET --header 'Accept: application/json' --connect-timeout 2 -m 2 $TestUrl)
    #echo $result_msg
    echo "running:`get_json_value "${result_msg}" "data"`"
}

# See how we were called.
RETVAL="0"
case "$1" in
    start)
        start
        ;;
    stop)
        stop
        ;;
    status)
        status
        ;;
    *)
      usage
      ;;
esac

exit $RETVAL
```

è¯´æ˜ï¼šè¿™é‡Œä¸ºäº†å¤ç°å‡æ­»çŠ¶æ€ï¼Œç‰¹æ„æ¨¡æ‹Ÿäº†ä¼‘çœ æ—¶é—´ï¼Œå¹¶ä¸”å°†è¶…æ—¶æ—¶é—´ä¿®æ”¹ä¸º 2 ç§’ï¼Œå®é™…ä½¿ç”¨ä¸­è¯·ä¿®æ”¹ä¸ºè‡ªå·±ä¸šåŠ¡çš„ç«¯å£å’Œæ¥å£åœ°å€ï¼Œä»¥åŠè¶…æ—¶æ—¶é—´

> curl è¯·æ±‚è¶…æ—¶æ—¶é—´ä¸è¦è¿‡é•¿ï¼Œå»ºè®®æ§åˆ¶åœ¨ 1 ç§’ã€‚å› ä¸ºè·å–é¡¹ç›®çŠ¶æ€æ˜¯ä¸²è¡Œæ‰§è¡Œï¼Œå¦‚æœå•ä¸ªé¡¹ç›® status æ‰§è¡Œè€—æ—¶è¿‡å¤§ä¼šå½±å“æŸ¥çœ‹èŠ‚ç‚¹é¡¹ç›®çŠ¶æ€ç›¸å…³åŠŸèƒ½

::: danger è¡¥å……è¯´æ˜
åœ¨ Jpom ä¸­ï¼Œé‡å¯æµç¨‹çœ‹ä¸‹å›¾ã€‚åœ¨ä¸€äº›æç«¯æƒ…å†µä¸‹ï¼Œå¯èƒ½å‡ºç°å·²ç»æ— æ³•ç›‘æ§åˆ°è¿è¡ŒçŠ¶æ€äº†ï¼Œä½†æ˜¯é¡¹ç›®è¿›ç¨‹è¿˜å­˜åœ¨ã€‚è¿™æ ·å¦‚æœç›´æ¥æ‰§è¡Œå¯åŠ¨å¾ˆå¤§å¯èƒ½å‡ºç°é¡¹ç›®ç«¯å£è¢«å ç”¨çš„æƒ…å†µã€‚ç›®å‰å»ºè®®åœ¨ DSL è„šæœ¬çš„ start æ–¹æ³•ä¸­æ‰‹åŠ¨è°ƒç”¨ä¸€ä¸‹ stopï¼ˆåç»­ç‰ˆæœ¬ä¼šä¼˜åŒ–æ­¤æµç¨‹ï¼‰
:::

![install1](/images/restart-steps.png)

## é…ç½®é‚®ä»¶å‘é€ä¿¡æ¯

### é…ç½®é‚®ä»¶å‘ä»¶äºº

![install1](/images/tutorial/monitor-notice/img15.png)

æ³¨æ„ï¼šå¯†ç ä¸€èˆ¬ä¸ºæˆæƒç å¹¶å‘é‚®ä»¶çš„ç™»é™†å¯†ç ï¼Œè¿™é‡Œä½¿ç”¨ QQ é‚®ç®±ä¸ºä¾‹ï¼Œä¸åŒå¹³å°è·å–é‚®ç®±æˆæƒç æ–¹å¼ä¸ä¸€æ ·ï¼Œå®é™…ä½¿ç”¨ä¸­å¯ä»¥åœ¨æœç´¢å¼•æ“ä¸­æœç´¢æŸ¥çœ‹ç”Ÿæˆé‚®ç®±æˆæƒç æ–¹æ³•

![install1](/images/tutorial/monitor-notice/img16.png)

## é…ç½®ç›‘æ§ä¿¡æ¯

![img.png](/images/tutorial/dsl_curl_java/2img.png)

![img_1.png](/images/tutorial/dsl_curl_java/2img_1.png)

## æ„‰å¿«ä½¿ç”¨

è¿™æ ·å°±å®ç°ä½¿ç”¨æ¥å£æ¥æ¢æ´»ç›‘æ§é¡¹ç›®çŠ¶æ€å¹¶ä¸”å¯ä»¥é‚®ä»¶æŠ¥è­¦ç­‰ï¼Œæ›´å¤šé…ç½®æ•ˆæœç­‰æ‚¨æ¥å‘ç°ï¼
