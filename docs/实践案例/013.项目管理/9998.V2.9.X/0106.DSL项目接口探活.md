---
title: DSLé¡¹ç›®æŽ¥å£æŽ¢æ´»
date: 2022-10-21 09:31:18
permalink: /pages/ac7b66/
categories:
  - docs
  - å®žè·µæ¡ˆä¾‹
  - é¡¹ç›®ç®¡ç†
tags:
  - 
---


## å‰è¨€

æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚æžœä½¿ç”¨ DSL æ¨¡å¼çš„é¡¹ç›®æ¥å®žçŽ°æŽ¥å£æŽ¢æ´»ç®¡ç†é¡¹ç›®è¿è¡ŒçŠ¶æ€

> æœ¬æ–‡ä¸­æœåŠ¡ç«¯å’Œæ’ä»¶ç«¯æ˜¯å®‰è£…åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸­çš„ï¼Œå®žé™…æ“ä½œæ—¶æ ¹æ®ä¸šåŠ¡æƒ…å†µæ¥å®‰è£…
>
> æ–‡ä¸­ä½¿ç”¨åˆ°çš„ä¾èµ–çŽ¯å¢ƒç‰ˆæœ¬ä»…ä¾›å‚è€ƒï¼Œå®žé™…ä½¿ç”¨ä¸­è¯·æ ¹æ®ä¸šåŠ¡æƒ…å†µæ¥å®‰è£…å¯¹åº”çš„ç‰ˆæœ¬

> æ³¨æ„ï¼šæœ¬æ–‡é‡‡ç”¨ä¸€é”®å®‰è£…åŒæ—¶åŸºäºŽ 2.9.13 ç‰ˆæœ¬è®²è§£,ç³»ç»Ÿä¸º centos

## éœ€è¦å‡†å¤‡çš„çŽ¯å¢ƒ

1. Jpom æœåŠ¡ç«¯
   1. å®‰è£… jpom éœ€è¦ java çŽ¯å¢ƒ
   2. æž„å»ºéœ€è¦ maven çŽ¯å¢ƒ
2. Jpom æ’ä»¶ç«¯
   1. å®‰è£… jpom éœ€è¦ java çŽ¯å¢ƒ
3. ä¸€ä¸ªä»£ç ä»“åº“ï¼ˆæ¡ˆä¾‹ä¸­ä½¿ç”¨ java é¡¹ç›®ï¼‰

### å®‰è£…æ’ä»¶ç«¯æŽ¨èå‘½ä»¤

> æŽ¨èå‘½ä»¤ä¼šè‡ªåŠ¨æ£€æŸ¥çŽ¯å¢ƒä¸­æ˜¯å¦å­˜åœ¨ jdk å¦‚æžœä¸å­˜åœ¨å°†è‡ªåŠ¨å®‰è£… jdk
>
> ä¸€èˆ¬æƒ…å†µå»ºè®®è‡ªè¡Œå®‰è£…ï¼Œå¦‚æžœä¸éœ€è¦è‡ªåŠ¨å®‰è£…åˆ é™¤å‘½ä»¤æœ€åŽçš„ `jdk` å³å¯

```shell
# å®‰è£…æ’ä»¶ç«¯å’Œ jdk çŽ¯å¢ƒ
yum install -y wget && \
wget -O install.sh https://jpom.top/docs/install.sh && \
bash install.sh Agent jdk
```

### å®‰è£…æœåŠ¡ç«¯æŽ¨èå‘½ä»¤

> æŽ¨èå‘½ä»¤ä¼šè‡ªåŠ¨æ£€æŸ¥çŽ¯å¢ƒä¸­æ˜¯å¦å­˜åœ¨ jdk å’Œ maven å¦‚æžœä¸å­˜åœ¨å°†è‡ªåŠ¨å®‰è£… jdk å’Œ maven
> 
> ä¸€èˆ¬æƒ…å†µå»ºè®®è‡ªè¡Œå®‰è£…ï¼Œå¦‚æžœä¸éœ€è¦è‡ªåŠ¨å®‰è£…åˆ é™¤å‘½ä»¤æœ€åŽçš„ `jdk+mvn` å³å¯

```shell
# å®‰è£…æœåŠ¡ç«¯å’Œ jdkã€maven çŽ¯å¢ƒ
yum install -y wget && \
wget -O install.sh https://jpom.top/docs/install.sh && \
bash install.sh Server jdk+mvn
```

::: tip ðŸ˜‹
æ¡ˆä¾‹å°±é»˜è®¤æ‚¨å·²ç»å®‰è£…å¥½ä¸Šè¿°çŽ¯å¢ƒï¼ˆjpom æ’ä»¶ç«¯ã€jpom æœåŠ¡ç«¯ã€maven æ’ä»¶ï¼‰
:::

::: tip ðŸ˜‹
æ¡ˆä¾‹å°±é»˜è®¤æ‚¨å·²ç»åˆå§‹å¥½æœåŠ¡ç«¯å¹¶ä¸”é…ç½®äº†èŠ‚ç‚¹
:::

::: danger ðŸ˜‹
å¦‚æžœå¯¹å®‰è£…æµç¨‹å’Œåˆå§‹åŒ–æµç¨‹ä¸æ˜¯äº†è§£æœ‰ç–‘é—®çš„å¯ä»¥å‚è€ƒå…¶ä»–[å®žè·µæ¡ˆä¾‹](/pages/practice/)å’Œ[å®‰è£…è¯´æ˜Žæ–‡æ¡£](/pages/install/)
:::

## é…ç½® DSL è„šæœ¬

è¿™é‡Œçš„è„šæœ¬æ˜¯ä¸ºäº†èƒ½æŽ§åˆ¶é¡¹ç›®çš„å¯åŠ¨ã€åœæ­¢ã€èŽ·å–é¡¹ç›®çŠ¶æ€

![img.png](/images/tutorial/dsl_curl_java/img.png)

![img_1.png](/images/tutorial/dsl_curl_java/img_1.png)

### è„šæœ¬å†…å®¹

```shell
#!/bin/bash
Tag="Application_${PROJECT_ID}"
MainClass="org.springframework.boot.loader.JarLauncher"
Lib="${PROJECT_PATH}"
Log="${PROJECT_PATH}/run.log"
JVM="-server -Xms128m -Xmx128m -XX:PermSize=32M -XX:MaxNewSize=64m -XX:MaxPermSize=64m -Djava.awt.headless=true -XX:+CMSClassUnloadingEnabled -XX:+CMSPermGenSweepingEnabled"
echo $Tag
RETVAL="0"

# See how we were called.
function start() {
    echo  $Log 
    if [ ! -f $Log ]; then
        touch $Log
    fi
    nohup java $JVM -Dappliction=$Tag -Djava.ext.dirs=$Lib":${JAVA_HOME}/jre/lib/ext" $MainClass > $Log 2>&1 &
	sleep 3
    head -n 10 $Log
}


function stop() {
    pid=$(ps -ef | grep -v 'grep' | egrep $Tag| awk '{printf $2 " "}')
    if [ "$pid" != "" ]; then      
        echo -n "boot ( pid $pid) is running" 
        echo 
        echo -n $"Shutting down boot: "
        pid=$(ps -ef | grep -v 'grep' | egrep $Tag| awk '{printf $2 " "}')
        if [ "$pid" != "" ]; then
            echo "kill boot process"
            kill -9 "$pid"
        fi
        else 
             echo "boot is stopped" 
        fi

    status
}

function get_json_value()
{
  local json=$1
  local key=$2
  local value=$(echo "${json}" | awk -F "[{,:}]" '{for(i=1;i<=NF;i++){if($i~"'${key}'"){print $(i+1)}}}' | sed 's/\"//g') 
  echo ${value}
}

function status()
{
   #  è¿™é‡Œçš„ç«¯å£æˆ–è€…url è·¯å¾„éœ€è¦è·Ÿè¿›ä½ çš„é¡¹ç›®ç«¯å£å’ŒèŽ·å–é¡¹ç›®çŠ¶æ€çš„æŽ¥å£æ¥å®š
    result_msg=$(curl -s -X GET --header 'Accept: application/json' --connect-timeout 1 -m 1 'http://127.0.0.1:8084')
    echo "running:`get_json_value "${result_msg}" "pid"`"
}

# See how we were called.
RETVAL="0"
case "$1" in
    start)
        start
        ;;
    stop)
        stop
        ;;
    status)
        status
        ;;
    *)
      usage
      ;;
esac

exit $RETVAL

```

### å…³äºŽè„šæœ¬çš„å‡ ä¸ªè¯´æ˜Ž

å¯ä»¥æŸ¥é˜… [DSL è„šæœ¬çš„åŸºç¡€ä»‹ç»](/pages/FQA/DSL/)äº†è§£åŸºç¡€ä½¿ç”¨è§„åˆ™

1. æ¡ˆä¾‹ä¸­æ˜¯ç®¡ç† Java é¡¹ç›®ï¼Œå®žé™…ä¸­å¯ä»¥è·Ÿè¿›è‡ªå·±çš„éœ€æ±‚è°ƒæ•´è„šæœ¬å†…å®¹æ¥ç®¡ç†å…¶ä»–é¡¹ç›®
2. æ³¨æ„åœ¨ä½¿ç”¨è¿‡ status æ–¹æ³•ä¸­ä¿®æ”¹ä¸ºå½“å‰é¡¹ç›®çš„ç«¯å£å·ï¼Œurl åœ°å€ã€‚
3. status è¯·æ±‚é¡¹ç›®çš„ url åœ°å€ä¸­å»ºè®®è¿”å›žå½“å‰é¡¹ç›®çš„è¿›ç¨‹å·ï¼ˆpidï¼‰
4. curl è¯·æ±‚è¶…æ—¶æ—¶é—´ä¸è¦è¿‡é•¿ï¼Œå»ºè®®æŽ§åˆ¶åœ¨ `1 ç§’`ã€‚å› ä¸ºèŽ·å–é¡¹ç›®çŠ¶æ€æ˜¯`ä¸²è¡Œæ‰§è¡Œ`ï¼Œå¦‚æžœå•ä¸ªé¡¹ç›® status æ‰§è¡Œè€—æ—¶è¿‡å¤§ä¼šå½±å“æŸ¥çœ‹èŠ‚ç‚¹é¡¹ç›®çŠ¶æ€ç›¸å…³åŠŸèƒ½

## é…ç½®é¡¹ç›®

### é…ç½®é¡¹ç›®ç™½åå•

ç”¨äºŽæŽ§åˆ¶é¡¹ç›®å­˜å‚¨çš„ç›®å½•ï¼Œ[æ›´å¤šè¯´æ˜Ž](/pages/0b946a/)

![img_3.png](/images/tutorial/dsl_curl_java/img_3.png)

### åˆ›å»ºé¡¹ç›®

![img_2.png](/images/tutorial/dsl_curl_java/img_2.png)

![img_4.png](/images/tutorial/dsl_curl_java/img_4.png)

![img_5.png](/images/tutorial/dsl_curl_java/img_5.png)

DSL é…ç½®å†…å®¹ï¼š

```yaml
# scriptId å¯ä»¥æ˜¯é¡¹ç›®è·¯å¾„ä¸‹è„šæœ¬æ–‡ä»¶åæˆ–è€…ç³»ç»Ÿä¸­çš„è„šæœ¬æ¨¡ç‰ˆID
description: æµ‹è¯•
run:
  start:
#    scriptId: project.sh
    scriptId: ddda4421102c4a1287718fd939cd31d7
    scriptArgs: start
  status:
#    scriptId: project.sh
    scriptId: ddda4421102c4a1287718fd939cd31d7
    scriptArgs: status
  stop:
#    scriptId: project.sh
    scriptId: ddda4421102c4a1287718fd939cd31d7
    scriptArgs: stop
file:
# å¤‡ä»½æ–‡ä»¶ä¿ç•™ä¸ªæ•°
#  backupCount: 5
# é™åˆ¶å¤‡ä»½æŒ‡å®šæ–‡ä»¶åŽç¼€ï¼ˆæ”¯æŒæ­£åˆ™ï¼‰
#  backupSuffix: [ '.jar','.html','^.+\.(?i)(txt)$' ]
config:
# æ˜¯å¦å¼€å¯æ—¥å¿—å¤‡ä»½åŠŸèƒ½
#  autoBackToFile: true

```

æ³¨æ„ï¼šscriptId éœ€è¦ä¿®æ”¹æ‚¨åˆ›å»ºå¯¹åº”çš„è„šæœ¬çš„IDï¼Œåœ¨ç¼–è¾‘å¼¹çª—ä¸­å¯ä»¥æŸ¥çœ‹åˆ°å¯¹åº”è„šæœ¬çš„ID

![img_6.png](/images/tutorial/dsl_curl_java/img_6.png)

## é…ç½®æž„å»ºå¹¶å‘å¸ƒåˆ°å½“å‰é¡¹ç›®

::: tip ðŸ˜‹
æ¡ˆä¾‹å°±é»˜è®¤æ‚¨å·²ç»ä¼šä½¿ç”¨æž„å»ºå’Œé¡¹ç›®å‘å¸ƒäº†ï¼ˆä¸ä¼šçš„å¯ä»¥å‚è€ƒå…¶ä»–å®žè·µæ¡ˆä¾‹ä¸­çš„è¯´æ˜Žæ¥æ“ä½œï¼‰
:::

![img_7.png](/images/tutorial/dsl_curl_java/img_7.png)

![img_8.png](/images/tutorial/dsl_curl_java/img_8.png)

## æŸ¥çœ‹é¡¹ç›®çŠ¶æ€

![img_9.png](/images/tutorial/dsl_curl_java/img_9.png)

![img_10.png](/images/tutorial/dsl_curl_java/img_10.png)

è¿™æ ·å°±å®žçŽ°ä½¿ç”¨æŽ¥å£æ¥æŽ¢æ´»ç›‘æŽ§é¡¹ç›®çŠ¶æ€äº†



