---
title: åœ¨ Jpom ä¸­å¦‚ä½•ä½¿ç”¨ DSL é¡¹ç›®æ¥ç®¡ç† TOMCAT
date: 2023-02-14 22:05:11
permalink: /pages/dc2836/
categories:
  - docs
  - å®è·µæ¡ˆä¾‹
  - é¡¹ç›®ç®¡ç†
tags:
  - tomcat
---

## å‰è¨€

æœ¬æ–‡ä¸»è¦è®²è§£å¦‚æœä½¿ç”¨ Jpom ä¸­çš„ DSL é¡¹ç›® + åœ¨çº¿æ„å»ºæ¥å®ç°æ—¥å¸¸ç®¡ç† tomcat + éƒ¨ç½²ç›¸å…³ç›¸å…³ä½¿ç”¨æµç¨‹

> æ³¨æ„ï¼šæœ¬æ–‡é‡‡ç”¨ä¸€é”®å®‰è£…åŒæ—¶åŸºäº 2.10.16 ç‰ˆæœ¬è®²è§£,ç³»ç»Ÿä¸º centos

## éœ€è¦å‡†å¤‡çš„ç¯å¢ƒ

1. Jpom æœåŠ¡ç«¯
	1. å®‰è£… jpom éœ€è¦ java ç¯å¢ƒ
	2. æ„å»ºéœ€è¦ maven ç¯å¢ƒ
2. Jpom æ’ä»¶ç«¯
	1. å®‰è£… jpom éœ€è¦ java ç¯å¢ƒ
3. Tomcat å®‰è£…åŒ…
4. ä¸€ä¸ª tomcat war åŒ…é¡¹ç›®ä»£ç ä»“åº“ï¼ˆæ¡ˆä¾‹ä¸­ä½¿ç”¨ java é¡¹ç›®ï¼‰


### å®‰è£…æ’ä»¶ç«¯æ¨èå‘½ä»¤

> æ¨èå‘½ä»¤ä¼šè‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒä¸­æ˜¯å¦å­˜åœ¨ jdk å¦‚æœä¸å­˜åœ¨å°†è‡ªåŠ¨å®‰è£… jdkã€‚å¹¶ä¸”å°†æ’ä»¶ç«¯å®‰è£…åˆ°é»˜è®¤ç›®å½•ï¼š/usr/local/jpom-agent
>
> ä¸€èˆ¬æƒ…å†µå»ºè®®è‡ªè¡Œå®‰è£…ï¼Œå¦‚æœä¸éœ€è¦è‡ªåŠ¨å®‰è£…åˆ é™¤å‘½ä»¤æœ€åçš„ `jdk` å³å¯

```shell
# å®‰è£…æ’ä»¶ç«¯å’Œ jdk ç¯å¢ƒ
curl -fsSL https://jpom.top/docs/install.sh | bash -s Agent jdk+default
```

### å®‰è£…æœåŠ¡ç«¯æ¨èå‘½ä»¤

> æ¨èå‘½ä»¤ä¼šè‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒä¸­æ˜¯å¦å­˜åœ¨ jdk å’Œ maven å¦‚æœä¸å­˜åœ¨å°†è‡ªåŠ¨å®‰è£… jdk å’Œ mavenã€‚å¹¶ä¸”å°†æœåŠ¡ç«¯å®‰è£…åˆ°é»˜è®¤ç›®å½•ï¼š/usr/local/jpom-server
>
> ä¸€èˆ¬æƒ…å†µå»ºè®®è‡ªè¡Œå®‰è£…ï¼Œå¦‚æœä¸éœ€è¦è‡ªåŠ¨å®‰è£…åˆ é™¤å‘½ä»¤æœ€åçš„ `jdk+mvn` å³å¯

```shell
# å®‰è£…æœåŠ¡ç«¯å’Œ jdkã€maven ç¯å¢ƒ
# å®‰è£…æ’ä»¶ç«¯å’Œ jdk ç¯å¢ƒ
curl -fsSL https://jpom.top/docs/install.sh | bash -s Server jdk+mvn+default
```

::: tip ğŸ˜‹
æ¡ˆä¾‹å°±é»˜è®¤æ‚¨å·²ç»å®‰è£…å¥½ä¸Šè¿°ç¯å¢ƒï¼ˆjpom æ’ä»¶ç«¯ã€jpom æœåŠ¡ç«¯ã€maven æ’ä»¶ï¼‰
:::

::: tip ğŸ˜‹
æ¡ˆä¾‹å°±é»˜è®¤æ‚¨å·²ç»åˆå§‹å¥½æœåŠ¡ç«¯å¹¶ä¸”é…ç½®äº†èŠ‚ç‚¹
:::

::: danger ğŸ˜‹
å¦‚æœå¯¹å®‰è£…æµç¨‹å’Œåˆå§‹åŒ–æµç¨‹ä¸æ˜¯äº†è§£æœ‰ç–‘é—®çš„å¯ä»¥å‚è€ƒå…¶ä»–[å®è·µæ¡ˆä¾‹](/pages/practice/)å’Œ[å®‰è£…è¯´æ˜æ–‡æ¡£](/pages/install/)
:::

## åˆ›å»º tomcat é¡¹ç›®


### é…ç½®é¡¹ç›®ç™½åå•

éœ€è¦æå‰é…ç½®ç™½åå•è·¯å¾„å¥¥ï¼Œä¸çŸ¥é“ç™½åå•è·¯å¾„ä½œç”¨çš„è¯·æŸ¥é˜…æ–‡æ¡£

### é…ç½®è¿œç¨‹ä¸‹è½½ host

æ–‡æ¡£æ¼”ç¤ºä¸­ä½¿ç”¨è¿œç¨‹ä¸‹è½½ tomcat æ–‡ä»¶å¹¶è§£å‹ï¼Œæ‰€ä»¥éœ€è¦æå‰é…ç½®ä¸‹è½½çš„ host

![img_1.png](/images/tutorial/use-tomcat/img_1.png)

### åˆ›å»ºé¡¹ç›®

è¿›å…¥èŠ‚ç‚¹ç®¡ç†>>ç®¡ç†>>é¡¹ç›®ç®¡ç†>>é¡¹ç›®åˆ—è¡¨ï¼Œè¿›è¡Œé¡¹ç›®åˆ›å»º

![img.png](/images/tutorial/use-tomcat/img.png)

![img_2.png](/images/tutorial/use-tomcat/img_2.png)

### ä¸‹è½½ tomcat å®‰è£…åŒ…

![img_3.png](/images/tutorial/use-tomcat/img_3.png)

![img_4.png](/images/tutorial/use-tomcat/img_4.png)

![img_5.png](/images/tutorial/use-tomcat/img_5.png)

é…ç½®å‰”é™¤æ–‡ä»¶å¤¹ä¸º 1 ,æ˜¯å› ä¸º tomcat å®‰è£…åŒ…é‡Œé¢ä¼šè‡ªåŠ¨åŒ…å«ä¸€å±‚æ–‡ä»¶å¤¹åï¼ˆapache-tomcat-10.0.27ï¼‰ï¼Œæˆ‘ä»¬è¿™é‡Œå°† tomcat æ‰€æœ‰æ–‡ä»¶è§£å‹åˆ°é¡¹ç›®æ ¹ç›®å½•æ‰€ä»¥éœ€è¦å‰”é™¤ç¬¬ä¸€çº§æ–‡ä»¶å¤¹

![img_6.png](/images/tutorial/use-tomcat/img_6.png)

## é…ç½® DSL è„šæœ¬

è¿™é‡Œé…ç½® DSL è„šæœ¬æ˜¯ç”¨æ¥è·å– tomcat å½“å‰çŠ¶æ€ï¼Œå› ä¸ºå¯åŠ¨ã€åœæ­¢ tomcat æˆ‘ä»¬å·²ç»ä½¿ç”¨ tomcat æä¾›çš„é»˜è®¤è„šæœ¬æ¥å®ç°äº†ã€‚

![img_7.png](/images/tutorial/use-tomcat/img_7.png)

![img_8.png](/images/tutorial/use-tomcat/img_8.png)

ä¿å­˜åç‚¹å‡»ç¼–è¾‘ï¼ŒæŸ¥çœ‹è„šæœ¬ id

![img_9.png](/images/tutorial/use-tomcat/img_9.png)

å¤åˆ¶è„šæœ¬ id ã€åˆ°é¡¹ç›® DSL å†…å®¹æ›¿æ¢ status çš„ scriptId å­—æ®µ

![img_10.png](/images/tutorial/use-tomcat/img_10.png)


## ç®¡ç† tomcat 

![img_11.png](/images/tutorial/use-tomcat/img_11.png)

### å¯åŠ¨

![img_12.png](/images/tutorial/use-tomcat/img_12.png)

![img_13.png](/images/tutorial/use-tomcat/img_13.png)

è¿™é‡Œå‘ç°å¯åŠ¨æ—¶å€™æœ‰é”™è¯¯ä¿¡æ¯ï¼Œé€šè¿‡æ’æŸ¥æ–‡ä»¶æ˜¯è‚¯å®šå­˜åœ¨çš„ã€‚é‚£ä¹ˆå°±æ˜¯æ–‡ä»¶æ‰§è¡Œæƒé™çš„é—®é¢˜äº†ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦å°† tomcat bin ç›®å½•æ·»åŠ å¯æ‰§è¡Œæƒé™

```shell
# éœ€è¦è‡ªè¡Œæ›¿æ¢ä¸ºæ‚¨çš„é¡¹ç›®å®é™…è·¯å¾„
chmod +x /data/jpom/tomcat/bin/*.sh
```

æ‰§è¡Œå‰

![img_14.png](/images/tutorial/use-tomcat/img_14.png)

æ‰§è¡Œå

![img_15.png](/images/tutorial/use-tomcat/img_15.png)

***å†æ¬¡æ‰§è¡Œå¯åŠ¨*

![img_16.png](/images/tutorial/use-tomcat/img_16.png)

![img_17.png](/images/tutorial/use-tomcat/img_17.png)

### åœæ­¢ã€é‡å¯

![img_18.png](/images/tutorial/use-tomcat/img_18.png)


### æ„‰å¿«çš„ç®¡ç† tomcat

åˆ°è¿™é‡Œæ‚¨å¯ä»¥é€šè¿‡ tomcat ç®¡ç†é¡µé¢æ¥ç®¡ç† tomcat çš„çŠ¶æ€ã€ç¼–è¾‘æ–‡ä»¶ã€ä¸‹è½½æ–‡ä»¶ã€ä¸Šä¼ æ–‡ä»¶ã€åˆ é™¤æ–‡ä»¶ï¼‰ç­‰ã€‚

å¦‚æœæ‚¨æƒ³é€šè¿‡ jpom æŸ¥çœ‹ tomcat çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ–‡ä»¶è¿½è¸ªã€æ—¥å¿—é˜…è¯»ï¼ˆæ—¥å¿—æœç´¢ï¼‰ç›¸å…³åŠŸèƒ½æ¥å®ç°ï¼Œè¯¦æƒ…å¯ä»¥æŸ¥é˜…å…¶ä»–æ–‡æ¡£


## æ„å»ºå‘å¸ƒ

### åˆ›å»ºé¡¹ç›®ä»“åº“

è¿™é‡Œæˆ‘ä»¬å°±é»˜è®¤æ‚¨å·²ç»ä¼šé…ç½®ä»“åº“äº†

æ–‡æ¡£ä½¿ç”¨ jpom æ¡ˆä¾‹ä»“åº“ï¼š[https://gitee.com/keepbx/Jpom-demo-case](https://gitee.com/keepbx/Jpom-demo-case)

![img_19.png](/images/tutorial/use-tomcat/img_19.png)

### é…ç½®æ„å»ºå‘å¸ƒé¡¹ç›®

![img_20.png](/images/tutorial/use-tomcat/img_20.png)


![img_21.png](/images/tutorial/use-tomcat/img_21.png)

**äº§ç‰©ç›®å½•**ï¼šspringboot-test-war/target/springboot-test-war-2.7.1.war éœ€è¦æ ¹æ®æ‚¨é¡¹ç›®æ‰“åŒ…å war å®é™…è·¯å¾„æ›¿æ¢

**äºŒçº§ç›®å½•**ï¼šwebapps è¿™é‡Œï¼Œæˆ‘ä»¬å°† war å‘å¸ƒåˆ° tomcat é¡¹ç›®çš„ç›®å½•ä¸‹çš„ webapps ç›®å½•ä¸‹

![img_22.png](/images/tutorial/use-tomcat/img_22.png)

![img_23.png](/images/tutorial/use-tomcat/img_23.png)

![img_24.png](/images/tutorial/use-tomcat/img_24.png)

![img_25.png](/images/tutorial/use-tomcat/img_25.png)

## é™„ä»¶

### DSLé…ç½®å†…å®¹

```yaml
# scriptId å¯ä»¥æ˜¯é¡¹ç›®è·¯å¾„ä¸‹è„šæœ¬æ–‡ä»¶åæˆ–è€…ç³»ç»Ÿä¸­çš„è„šæœ¬æ¨¡ç‰ˆID
description: æµ‹è¯•
run:
  start:
#    scriptId: project.sh
    scriptId: ./bin/startup.sh
    scriptArgs: 
  status:
#    scriptId: project.sh
    scriptId: c46d184b642f42e1b210c6c8a036a463
    scriptArgs: 
  stop:
#    scriptId: project.sh
    scriptId: ./bin/shutdown.sh
    scriptArgs: 
#  restart:
##    scriptId: project.sh
#    scriptId: eb16f693147b43a1b06f9eb96aed1bc7
#    scriptArgs: restart
#    scriptEnv:
#      "boot_active": test
file:
# å¤‡ä»½æ–‡ä»¶ä¿ç•™ä¸ªæ•°
#  backupCount: 5
# é™åˆ¶å¤‡ä»½æŒ‡å®šæ–‡ä»¶åç¼€ï¼ˆæ”¯æŒæ­£åˆ™ï¼‰
#  backupSuffix: [ '.jar','.html','^.+\.(?i)(txt)$' ]
config:
# æ˜¯å¦å¼€å¯æ—¥å¿—å¤‡ä»½åŠŸèƒ½
#  autoBackToFile: true
```

### è·å– tomcat çŠ¶æ€è„šæœ¬

```shell
Tag="=${PROJECT_PATH}"

pid=$(ps -ef | grep -v 'grep' | egrep $Tag| awk '{printf $2 " "}')
#echo "$pid"
if [ "$pid" != "" ]; then
	echo "running:$pid"
else
	echo "boot is stopped"
fi
```