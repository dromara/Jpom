---
title: åœ¨ Jpom ä¸­å¦‚ä½•ä½¿ç”¨ DSL é¡¹ç›®æ¥ç®¡ç† NGINX
date: 2024-01-02 15:00:00
permalink: /pages/dc2836/
categories:
  - docs
  - å®è·µæ¡ˆä¾‹
  - é¡¹ç›®ç®¡ç†
tags:
  - nginx
---

## å‰è¨€

æœ¬æ–‡ä¸»è¦è®²è§£å¦‚æœä½¿ç”¨ Jpom ä¸­çš„ DSL é¡¹ç›® å¯¹Nginxçš„åŸºç¡€ç®¡ç†

> æ³¨æ„ï¼šæœ¬æ–‡é‡‡ç”¨ä¸€é”®å®‰è£…åŒæ—¶åŸºäº 2.10.16 ç‰ˆæœ¬è®²è§£,ç³»ç»Ÿä¸º Centos / Windows

## éœ€è¦å‡†å¤‡çš„ç¯å¢ƒ

1. Jpom æœåŠ¡ç«¯
	1. å®‰è£… jpom éœ€è¦ java ç¯å¢ƒ
	2. æ„å»ºéœ€è¦ maven ç¯å¢ƒ
2. Jpom æ’ä»¶ç«¯
	1. å®‰è£… jpom éœ€è¦ java ç¯å¢ƒ
   2. æœåŠ¡å™¨ï¼šCentos / Windows
   3. æœåŠ¡å™¨éœ€å®‰è£…å¥½Nginxç¯å¢ƒï¼Œå¹¶æŠŠnginxæ·»åŠ åˆ°æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­


### å®‰è£…æ’ä»¶ç«¯æ¨èå‘½ä»¤

> æ¨èå‘½ä»¤ä¼šè‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒä¸­æ˜¯å¦å­˜åœ¨ jdk å¦‚æœä¸å­˜åœ¨å°†è‡ªåŠ¨å®‰è£… jdkã€‚å¹¶ä¸”å°†æ’ä»¶ç«¯å®‰è£…åˆ°é»˜è®¤ç›®å½•ï¼š/usr/local/jpom-agent
>
> ä¸€èˆ¬æƒ…å†µå»ºè®®è‡ªè¡Œå®‰è£…ï¼Œå¦‚æœä¸éœ€è¦è‡ªåŠ¨å®‰è£…åˆ é™¤å‘½ä»¤æœ€åçš„ `jdk` å³å¯

```shell
# å®‰è£…æ’ä»¶ç«¯å’Œ jdk ç¯å¢ƒ
curl -fsSL https://jpom.top/docs/install.sh | bash -s Agent jdk+default
```

### å®‰è£…æœåŠ¡ç«¯æ¨èå‘½ä»¤

> æ¨èå‘½ä»¤ä¼šè‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒä¸­æ˜¯å¦å­˜åœ¨ jdk å’Œ maven å¦‚æœä¸å­˜åœ¨å°†è‡ªåŠ¨å®‰è£… jdk å’Œ mavenã€‚å¹¶ä¸”å°†æœåŠ¡ç«¯å®‰è£…åˆ°é»˜è®¤ç›®å½•ï¼š/usr/local/jpom-server
>
> ä¸€èˆ¬æƒ…å†µå»ºè®®è‡ªè¡Œå®‰è£…ï¼Œå¦‚æœä¸éœ€è¦è‡ªåŠ¨å®‰è£…åˆ é™¤å‘½ä»¤æœ€åçš„ `jdk+mvn` å³å¯

```shell
# å®‰è£…æœåŠ¡ç«¯å’Œ jdkã€maven ç¯å¢ƒ
# å®‰è£…æ’ä»¶ç«¯å’Œ jdk ç¯å¢ƒ
curl -fsSL https://jpom.top/docs/install.sh | bash -s Server jdk+mvn+default
```

::: tip ğŸ˜‹
æ¡ˆä¾‹å°±é»˜è®¤æ‚¨å·²ç»å®‰è£…å¥½ä¸Šè¿°ç¯å¢ƒï¼ˆjpom æ’ä»¶ç«¯ã€jpom æœåŠ¡ç«¯ã€maven æ’ä»¶ï¼‰
:::

::: tip ğŸ˜‹
æ¡ˆä¾‹å°±é»˜è®¤æ‚¨å·²ç»åˆå§‹å¥½æœåŠ¡ç«¯å¹¶ä¸”é…ç½®äº†èŠ‚ç‚¹
:::

::: danger ğŸ˜‹
å¦‚æœå¯¹å®‰è£…æµç¨‹å’Œåˆå§‹åŒ–æµç¨‹ä¸æ˜¯äº†è§£æœ‰ç–‘é—®çš„å¯ä»¥å‚è€ƒå…¶ä»–[å®è·µæ¡ˆä¾‹](/pages/practice/)å’Œ[å®‰è£…è¯´æ˜æ–‡æ¡£](/pages/install/)
:::

## æ–°å»ºèŠ‚ç‚¹è„šæœ¬


### é…ç½®é¡¹ç›®ç™½åå•å’Œæ–‡ä»¶åç¼€

éœ€è¦æå‰é…ç½®ç™½åå•è·¯å¾„å’Œæ–‡ä»¶åç¼€å¥¥ï¼Œä¸çŸ¥é“ç™½åå•è·¯å¾„ä½œç”¨çš„è¯·æŸ¥é˜…æ–‡æ¡£

### é…ç½®èŠ‚ç‚¹è„šæœ¬ - Linux
```shell
#!/bin/bash
Tag="nginx"
RETVAL="0"

# See how we were called.
function start() {
	nginx
}


function stop() {
    pid=$(ps -ef | grep -v 'grep' | egrep $Tag| awk '{printf $2 " "}')
    if [ "$pid" != "" ]; then      
        echo -n "boot ( pid $pid) is running" 
        echo 
        echo -n $"Shutting down boot: "
        if [ "$pid" != "" ]; then
            echo "kill boot process"
            kill -9 `ps -ef | grep "nginx" | grep -v grep | awk '{print $2}'`
        fi
        else 
             echo "boot is stopped" 
        fi

    status
}


function restart() {
    nginx -s reload

    status
}


function status()
{
    pid=$(ps -ef | grep -v 'grep' | egrep $Tag| awk '{printf $2 " "}')
    #echo "$pid"
    if [ "$pid" != "" ]; then
        echo "running:$pid"
    else
        echo "boot is stopped"
    fi
}

# See how we were called.
RETVAL="0"
case "$1" in
    start)
        start
        ;;
    stop)
        stop
        ;;
    restart)
        restart
        ;;
    status)
        status
        ;;
    *)
      usage
      ;;
esac

exit $RETVAL
```

![image1.png](/images/tutorial/use-nginx/image1.png)

### é…ç½®èŠ‚ç‚¹è„šæœ¬ - Windows
```bat
@echo off

set NGINX_PATH=%PROJECT_PATH%\..\

IF "%1"=="start" goto start
IF "%1"=="stop" goto stop
IF "%1"=="restart" goto restart
IF "%1"=="status" goto status


@REM start
:start
	cd %NGINX_PATH% & start nginx
goto end

@REM restart
:restart
	cd %NGINX_PATH% & nginx -s reload
goto end

@REM stop
:stop
	for /f "tokens=2" %%I in ('tasklist ^| findstr nginx') do taskkill /F /pid %%I
goto end

@REM view status
:status
	for /f "tokens=2" %%I in ('tasklist ^| findstr nginx') do @echo running:%%I
goto end

:end
	EXIT 0
```

![image2.png](/images/tutorial/use-nginx/image2.png)

### è„šæœ¬é…ç½®å®Œæˆåï¼Œè·å–åˆ°scriptId

![image3.png](/images/tutorial/use-nginx/image3.png)

## æ–°å»ºDSLé¡¹ç›®
### æ–°å»ºLinuxé¡¹ç›®ï¼ˆè¿è¡Œæ–¹å¼DSLï¼‰
![image4.png](/images/tutorial/use-nginx/image4.png)
é¡¹ç›®è·¯å¾„å¯é…ç½®åˆ°Nginxçš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œæ–¹ä¾¿ç›´æ¥é€šè¿‡Jpomç¼–è¾‘é…ç½®æ–‡ä»¶
DSLé…ç½®å¦‚ä¸‹ï¼š
```shell
# scriptId å¯ä»¥æ˜¯é¡¹ç›®è·¯å¾„ä¸‹è„šæœ¬æ–‡ä»¶åæˆ–è€…ç³»ç»Ÿä¸­çš„è„šæœ¬æ¨¡ç‰ˆID
description: NGINXç®¡ç†
run:
  start:
    scriptId: 83b2be3f4d654ec0812a50e66b2e8646
    scriptArgs: start
    scriptEnv:
  restart:
    scriptId: 83b2be3f4d654ec0812a50e66b2e8646
    scriptArgs: restart
    scriptEnv:
  status:
    scriptId: 83b2be3f4d654ec0812a50e66b2e8646
    scriptArgs: status
    scriptEnv:
  stop:
    scriptId: 83b2be3f4d654ec0812a50e66b2e8646
    scriptArgs: stop
    scriptEnv:
```
scriptIdæ›¿æ¢æˆä¸Šé¢å¾—åˆ°çš„scriptId
### æ–°å»ºWindowsé¡¹ç›®ï¼ˆè¿è¡Œæ–¹å¼DSLï¼‰
![image5.png](/images/tutorial/use-nginx/image5.png)
é¡¹ç›®è·¯å¾„å¯é…ç½®åˆ°Nginxçš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œæ–¹ä¾¿ç›´æ¥é€šè¿‡Jpomç¼–è¾‘é…ç½®æ–‡ä»¶
DSLé…ç½®å¦‚ä¸‹ï¼š
```shell
# scriptId å¯ä»¥æ˜¯é¡¹ç›®è·¯å¾„ä¸‹è„šæœ¬æ–‡ä»¶åæˆ–è€…ç³»ç»Ÿä¸­çš„è„šæœ¬æ¨¡ç‰ˆID
description: NGINXç®¡ç†
run:
  start:
    scriptId: 8cf4a5aa2832414fbb942dcd27feafb6
    scriptArgs: start
    scriptEnv:
  restart:
    scriptId: 8cf4a5aa2832414fbb942dcd27feafb6
    scriptArgs: restart
    scriptEnv:
  status:
    scriptId: 8cf4a5aa2832414fbb942dcd27feafb6
    scriptArgs: status
    scriptEnv:
  stop:
    scriptId: 8cf4a5aa2832414fbb942dcd27feafb6
    scriptArgs: stop
    scriptEnv:

```
scriptIdæ›¿æ¢æˆä¸Šé¢å¾—åˆ°çš„scriptId

## æ§åˆ¶å°è¯´æ˜
![image6.png](/images/tutorial/use-nginx/image6.png)
å¯åŠ¨ã€é‡å¯ã€åœæ­¢ï¼šå³è°ƒç”¨ä¸Šé¢çš„DSLé…ç½®ä¸­çš„runä¸­çš„startã€restartã€stop

## æ–‡ä»¶ç®¡ç†
![image7.png](/images/tutorial/use-nginx/image7.png)
![image8.png](/images/tutorial/use-nginx/image8.png)
![image9.png](/images/tutorial/use-nginx/image9.png)
è¿™é‡Œï¼Œå¯ä»¥å¯¹Nginxçš„.confåç¼€é…ç½®æ–‡ä»¶è¿›è¡Œæ–°å¢ä¿®æ”¹ã€‚æ–‡ä»¶å˜æ›´åéœ€è¦é‡æ–°å›åˆ°æ§åˆ¶å°ä¸­ï¼Œç‚¹å‡» é‡å¯ å³å¯ç”Ÿæ•ˆã€‚