---
title: å¦‚ä½•å°† 2.8.x å‡çº§åˆ° 2.9.x
date: 2022-06-11 09:57:14
permalink: /pages/upgrade/2.8.x-to-2.9.x/
---

[[toc]]

## å‰è¨€

### é—®ï¼šå‡çº§åˆ° 2.9.x ä¸ºä»€ä¹ˆè¦ç‰¹æ®Šå¤„ç†ï¼Ÿ

**ç­”** ï¼šå› ä¸º H2 åœ¨ `1.4.198, 2.0.202` ç‰ˆæœ¬é—´å­˜åœ¨æ¼æ´ï¼Œæ¼æ´ç¼–å·ä¸ºï¼š`CVE-2021-23463`ï¼Œæ‰€ä»¥éœ€è¦å°½å¿«å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬æ¥é¿å…è¯¥æ¼æ´ã€‚
ä½†æ˜¯ H2 çš„ 1.4.x å‡çº§åˆ° 2.0.x æ˜¯ä¸å…¼å®¹ç‰ˆæœ¬å‡çº§ï¼Œä¸èƒ½ç›´æ¥æ— æ„Ÿå‡çº§ã€‚å¿…é¡»è¿ç§»æ—§æ•°æ®åˆ°æ–°ç‰ˆæœ¬ä¸­

---

### é—®ï¼šè¯¥æ¼æ´å‡ºç°äº†ä¸€æ®µæ—¶é—´ï¼Œä¸ºä»€ä¹ˆç°åœ¨æ‰å‘ä¿®å¤ç‰ˆï¼Ÿ

**ç­”**ï¼šå½“æˆ‘ä»¬çœ‹åˆ°æ¼æ´ç›¸å…³æ¶ˆæ¯å°±å¼€å§‹å‡†å¤‡æ–¹æ¡ˆï¼Œæˆ‘ä»¬åˆšå¼€å§‹æƒ³çš„æ–¹æ¡ˆæ˜¯å¦‚ä½•é¿å…è¿‡å¤šçš„äººä¸ºæ“ä½œï¼Œå°½é‡è‡ªåŠ¨åŒ–å®Œæˆã€‚
ç»“æœæˆ‘ä»¬å°è¯•å‘ç°æ²¡æœ‰åŠæ³•å¾ˆå¥½çš„é¿å…ï¼ˆå‡†å¤‡å‡ºä¸€ä¸ªç•Œé¢åŒ–çš„æ“ä½œï¼‰ï¼Œæœ€åé‡‡ç”¨å‘½ä»¤è¡Œæ–¹å¼æ“ä½œã€‚ï¼ˆæ­¤å¤„è‡ªåŠ¨ğŸ¶ï¼‰

## å‡çº§æµç¨‹æ€»è§ˆ

1. **éœ€è¦å…ˆå‡çº§åˆ° 2.8.24+** [å®‰è£…åŒ…ä¸‹è½½åœ°å€](https://gitee.com/dromara/Jpom/attach_files)
   1. å‡çº§æ–¹æ³•æœ‰ï¼šåœ¨çº¿å‡çº§ã€æ‰‹åŠ¨ä¸Šä¼  jar åŒ…ç­‰æ–¹å¼å‡çº§
2. æ£€æŸ¥ `Server.sh` è„šæœ¬ä¸­ `ARGS` å˜é‡æœ€åæ˜¯å¦å­˜åœ¨ `$@` å­—ç¬¦
   1. å¦‚æœä¸å­˜åœ¨åˆ™éœ€è¦æ‰‹åŠ¨æ·»åŠ 
   2. `ARGS` å˜é‡å®Œæ•´ç¤ºä¾‹ï¼š`ARGS="--jpom.applicationTag=${Tag} --spring.profiles.active=pro --server.port=2122  --jpom.log=${Path}log $@"`
3. **ä¸ºäº†æ•°æ®å®‰å…¨é¿å…å‡çº§å‡ºç°å¼‚å¸¸é€ æˆæ•°æ®ä¸¢å¤±ï¼Œè¯·æ‰‹åŠ¨å¤‡ä»½ä¸€ä¸‹ `db` ç›®å½•**
   1. å¤‡ä»½å‰ä¸€å®šè¦å…ˆå…³é—­æœåŠ¡å™¨ç¨‹åºï¼Œå¦åˆ™ä¼šå‡ºç°æ•°æ®åº“å¼‚å¸¸æƒ…å†µæˆ–è€…æ•°æ®ä¸¢å¤±ç­‰å¼‚å¸¸
   2. å…³é—­æ–¹å¼ï¼š`sh /xxxx/Server.sh stop`
   3. å¤‡ä»½ db ç›®å½•æ–¹å¼ï¼š`cp -r /xxxx/jpom-server/db /xxxx/jpom-server/db_backup`
4. é€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼åˆ›å»ºæ•°æ®å¤‡ä»½
    1. å¯åŠ¨ç¨‹åºå‚æ•°é‡Œé¢æ·»åŠ  --backup-h2
    2. linux ç¯å¢ƒä¸¾ä¾‹ï¼š`sh /xxxx/Server.sh restart --backup-h2`
    3. å½“æ§åˆ¶å°è¾“å‡º `Complete the backup database, save the path as /xxx/xxx/db/backup/xxxx.sql` å­—æ ·è¡¨ç¤ºå¤‡ä»½æˆåŠŸ
5. æ‰‹åŠ¨æ›¿æ¢ jar
   1. å°† lib ç›®å½•ä¸‹é¢çš„ `Server-2.8.x.jar` æ›¿æ¢ä¸ºæœ€æ–°çš„ `Server-2.9.x.jar`
   2. æ³¨æ„å¯èƒ½éœ€è¦ä¿®æ”¹ `Server.sh` è„šæœ¬é‡Œé¢çš„ `RUNJAR` å˜é‡å€¼ä¸ºæ‚¨ä¸Šä¼ æ–° jar çš„æ–‡ä»¶åï¼Œå¦‚ï¼š`Server-2.9.x.jar`
6. é€šè¿‡æŒ‡å®š sql æ–‡ä»¶æ–¹å¼å¯åŠ¨
   1. å¯åŠ¨ç¨‹åºå‚æ•°é‡Œé¢æ·»åŠ  `--replace-import-h2-sql=/xxxx.sql --transform-sql` (è·¯å¾„éœ€è¦æ›¿æ¢ä¸ºç¬¬äºŒæ­¥æ§åˆ¶å°è¾“å‡ºçš„ sql æ–‡ä»¶ä¿å­˜è·¯å¾„)
   2. linux ç¯å¢ƒä¸¾ä¾‹ï¼š`sh /xxxx/Server.sh restart --replace-import-h2-sql=/xxxx.sql --transform-sql`
7. è§‚å¯Ÿæ§åˆ¶è¾“å‡ºå†…å®¹
   1. å½“æ§åˆ¶å°è¾“å‡º `Import successfully according to sql,/xxx/xxx/db/backup/xxxx.sql` å­—æ ·è¡¨ç¤ºå‡çº§æˆåŠŸå¹¶è‡ªåŠ¨å¯åŠ¨ç¨‹åº
   2. å¦‚æœå‡ºç°å¼‚å¸¸ä¿¡æ¯å¯ä»¥å…ˆå°è¯•åœ¨æœç´¢å¼•æ“æœç´¢çœ‹çœ‹æ˜¯å¦æœ‰è§£å†³åŠæ³•
   3. è”ç³»å®˜æ–¹ååŠ©æ’æŸ¥
8. **è¡¥å……æ­¥éª¤ï¼š** æ“ä½œå®ŒæˆååŸºæœ¬åŠŸèƒ½ä½¿ç”¨æ­£å¸¸ï¼Œä½†æ˜¯ SSH ç›¸å…³åŠŸèƒ½ä¼šå‡ºç°æ•°æ®åº“å¼‚å¸¸ï¼ˆç¼ºå°‘å­—æ®µï¼‰
   1. éœ€è¦é‡æ–°åˆå§‹åŒ–æ•°æ®ï¼š`sh /xxxx/Server.sh restart --rest:load_init_db`
   2. æ‰§è¡Œè¿™ä¸ªæ“ä½œéœ€è¦ä½¿ç”¨ 2.9.1+ ç‰ˆæœ¬ï¼ˆ2.9.0 å­˜åœ¨é—®é¢˜ï¼Œæ­¤å¤„è‡ªåŠ¨ğŸ¶ï¼‰
9. æ„‰å¿«çš„ä½¿ç”¨ Jpom 2.9.x

## ç›¸å…³é—®é¢˜è¯´æ˜

### é—®ï¼šå¿…é¡»å…ˆå‡çº§åˆ° 2.8.24+ï¼Ÿ

**ç­”**ï¼šéå¿…é¡»ï¼Œå› ä¸º 2.8.24+ æ–°å¢äº†å‘½ä»¤è¡Œæ–¹å¼å¤‡ä»½æ•°æ®ï¼Œè¿™æ ·åœ¨ç¨‹åºæœªå¯åŠ¨å‰å°±å°†æ‰€æœ‰æ•°æ®å¤‡ä»½å¯¼å‡ºä¸º sql ä¿è¯å¯¼å‡ºçš„æ•°æ®æ˜¯æœ€æ–°å¹¶ä¸”å®Œæ•´çš„ã€‚
å¦‚æœæ‚¨ä¸æƒ³å‡çº§åˆ° 2.8.24+ å†å‡çº§åˆ° 2.9.x é‚£ä¹ˆå¯ä»¥å…ˆç”¨ç®¡ç†èº«ä»½ç™»å½•è¿›å…¥ç³»ç»Ÿè¿›å…¥ï¼šã€ç³»ç»Ÿç®¡ç† -> æ•°æ®åº“å¤‡ä»½ã€‘é¡µé¢é‡Œé¢å»åˆ›å»ºä¸€ä¸ªå…¨é‡å¤‡ä»½è®°ä½å¤‡ä»½æ–‡ä»¶å®Œæˆè·¯å¾„

**æ³¨æ„**ï¼š`ä¸é€šè¿‡å‘½ä»¤è¡Œå¤‡ä»½ä¸èƒ½ä¿è¯å¯¼å‡ºçš„å¤‡ä»½æ•°æ®ä¸€å®šæ˜¯æœ€æ–°çš„å¥¥ï¼Œå› ä¸ºç¨‹åºåœ¨è¿è¡Œä¸­éšæ—¶ä¼šäº§ç”Ÿæ–°æ•°æ®æˆ–è€…æ•°æ®æ›´æ–°æƒ…å†µ`


---- 

### é—®ï¼šå¦‚ä½•æŸ¥çœ‹å¤‡ä»½è®°å½•ä¸­çš„å¤‡ä»½æ–‡ä»¶è·¯å¾„ï¼Ÿ

**ç­”**ï¼šå¤‡ä»½åˆ—è¡¨ä¸­çŠ¶æ€åˆ—åé¢æœ‰ä¸€ä¸ªå¤åˆ¶æŒ‰é’®ï¼Œç‚¹å‡»ä¸€ä¸‹å°±å¤åˆ¶åˆ°ç²˜è´´æ¿å•¦

---- 

### é—®ï¼šæ‰§è¡Œ `sh /xxxx/Server.sh restart --backup-h2` ä¸ç”Ÿæ•ˆè¯¥æ€ä¹ˆåŠï¼Ÿ

**ç­”**ï¼šå¦‚æœä½ æ˜¯ä»å¾ˆæ—©å°±ä½¿ç”¨äº† Jpom é‚£ä¹ˆä½ ç°åœ¨ç®¡ç†æœåŠ¡ç«¯å½“è„šæœ¬ä¸æ˜¯æœ€æ–°å½“ï¼Œæœ€æ–°çš„ç®¡ç†è„šæœ¬é‡Œé¢å°†æ‰§è¡Œå‘½ä»¤çš„å…¶ä»–å‚æ•°ä¹Ÿä¼ å…¥äº†å¯åŠ¨ç¨‹åºé‡Œé¢

è§£å†³åŠæ³•æœ‰ï¼š

1. æ›¿æ¢ä¸ºæœ€æ–°çš„ç®¡ç†è„šæœ¬æ–‡ä»¶ [Server.sh](https://gitee.com/dromara/Jpom/blob/master/modules/server/script/Server.sh)
2. æ‰‹åŠ¨ä¿®æ”¹ç®¡ç†è„šæœ¬ï¼Œåœ¨è„šæœ¬ä¸­ `ARGS` å˜é‡æœ€åæ·»åŠ ä¸€ä¸ª `$@` å³å¯
   1. å®Œæ•´ç¤ºä¾‹ï¼š`ARGS="--jpom.applicationTag=${Tag} --spring.profiles.active=pro --server.port=2122  --jpom.log=${Path}log $@"`

----

### é—®ï¼šå®˜æ–¹æ˜¯ä¸æ˜¯å¿˜è®°è¿˜ç”¨ windows ç”¨æˆ·å•¦ï¼Ÿ

**ç­”**ï¼šæ²¡æœ‰çš„ï¼Œå› ä¸º linux ç”¨æˆ·åå¤šï¼Œæ‰€ä»¥æ‹¿ linux ä¸¾ä¾‹ã€‚windows å¤„ç†åŠæ³•ç±»ä¼¼

å¯ä»¥æŒ‰ç…§ [Server.bat](https://gitee.com/dromara/Jpom/blob/master/modules/server/script/Server.bat) ä¸­ if åˆ¤æ–­ç»§ç»­æ‰©å±•

```shell
set /p ID=
IF "!ID!"=="1" call:start
IF "!ID!"=="2" call:stop
IF "!ID!"=="3" call:status
IF "!ID!"=="4" call:restart
IF "!ID!"=="5" call:use
IF "!ID!"=="6" call:restart --rest:ip_config
IF "!ID!"=="7" call:restart --rest:load_init_db
IF "!ID!"=="8" call:restart --rest:super_user_pwd
IF "!ID!"=="0" EXIT
```

æ€è·¯æ·»åŠ  IF,æ¯”å¦‚ï¼š

```shell
set /p ID=
IF "!ID!"=="1" call:start
IF "!ID!"=="2" call:stop
IF "!ID!"=="3" call:status
IF "!ID!"=="4" call:restart
IF "!ID!"=="5" call:use
IF "!ID!"=="6" call:restart --rest:ip_config
IF "!ID!"=="7" call:restart --rest:load_init_db
IF "!ID!"=="8" call:restart --rest:super_user_pwd
IF "!ID!"=="9" call:restart --backup-h2
IF "!ID!"=="10" call:restart --replace-import-h2-sql=/xxxx.sql --transform-sql
IF "!ID!"=="0" EXIT
```

`æ³¨æ„è¦ä¿®æ”¹ sql è·¯å¾„`

----

### é—®ï¼šä¸æƒ³é€šè¿‡ç®¡ç†è„šæœ¬æ¥æ“ä½œï¼Œè¿˜æœ‰å…¶ä»–æ–¹æ³•å—ï¼Ÿ

**ç­”**ï¼šæœ‰

1. å¤‡ä»½æ•°æ®

```shell
java -jar server-2.8.24.jar --spring.profiles.active=pro --backup-h2
```
2. å¯¼å…¥æ•°æ®

```shell
java -jar server-2.9.0.jar --spring.profiles.active=pro --replace-import-h2-sql=/xxxx.sql --transform-sql
```

3. æ›´æ–°ç®¡ç†è„šæœ¬ä¸­çš„ï¼š`RUNJAR` å˜é‡å€¼ä¸ºï¼š`server-2.9.0.jar`

**æ³¨æ„**ï¼š

1. é€šè¿‡æ¬¡æ–¹å¼ä¸€å®šè¦åœ¨åŸç›®å½•æ“ä½œ
2. æ“ä½œé¡ºåºä¸€å®šæ˜¯è¦å…ˆä½¿ç”¨æ—§åŒ…å¤‡ä»½æ•°æ®ï¼Œå†é€šè¿‡æ–°åŒ…å¯¼å…¥æ•°æ®

----

### é—®ï¼šå®¹å™¨å®‰è£…çš„åº”è¯¥å¦‚ä½•å‡çº§ï¼Ÿ

**ç­”**ï¼šå‡çº§æµç¨‹å’Œ Linux æµç¨‹åŸºæœ¬ä¸€è‡´ï¼Œéœ€è¦æ³¨æ„çš„å°±æ˜¯ä¸Šä¼ æ–‡ä»¶çš„æ–¹å¼éœ€è¦å…ˆä¸Šä¼ åˆ°å®¿ä¸»æœºï¼Œå†é€šè¿‡ `docker cp` æ–¹å¼å°†æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨ä¸­ã€‚

ä¸‹é¢ä»¥ä» 2.8.24 å‡çº§åˆ° 2.9.0 ä¸ºä¾‹ï¼š

```shell
# æ³¨æ„ï¼šä» 2.8.24 ç‰ˆæœ¬å¼€å§‹æ–°å¢æ•°æ®åº“å¤‡ä»½çš„å‚æ•°å‘½ä»¤ï¼Œå»ºè®®å…ˆå‡çº§åˆ° 2.8.24
# å¤‡ä»½ä½ç‰ˆæœ¬æ•°æ®åº“
docker exec -it jpom-server /bin/bash /usr/local/jpom-server/Server.sh restart --backup-h2
# æ‰§è¡Œå®Œåçœ‹åˆ°ã€Need to log out manually: Ctrl+C/Control+Cã€‘ç”¨ Ctrl + C æ‰‹åŠ¨é€€å‡º

# æ›¿æ¢è„šæœ¬å‘½ä»¤ä¸­ä¸ºæ–°ç‰ˆ Jar åŒ…
docker exec -it jpom-server sed -r -e '/^RUNJAR="/s@.*@RUNJAR="Server-2.9.0.jar"@g' /usr/local/jpom-server/Server.sh -i

# docker cp æœ¬åœ°æ–‡ä»¶è·¯å¾„ å®¹å™¨ID/å®¹å™¨NAME:å®¹å™¨å†…è·¯å¾„
docker cp /root/Server-2.9.0.jar jpom-server:/usr/local/jpom-server/lib/Server-2.9.0.jar

# è¿›å…¥å®¹å™¨å†…éƒ¨
docker exec -it jpom-server /bin/bash
# å°†ä½ç‰ˆæœ¬çš„æ•°æ®åº“å¯¼å…¥åˆ°æ–°ç‰ˆæœ¬ä¸­
backupFile=`ls -t /usr/local/jpom-server/data/db/backup/ | head -1`
/bin/bash /usr/local/jpom-server/Server.sh restart --replace-import-h2-sql=/usr/local/jpom-server/data/db/backup/$backupFile --transform-sql
# å¯åŠ¨å®Œæˆåï¼Œè¾“å…¥ Ctrl + C é€€å‡ºã€‚
# é€€å‡ºå®¹å™¨ï¼Œå›åˆ°å®¿ä¸»æœº
exit
```

### é—®ï¼šå‡çº§æœåŠ¡ç«¯åéœ€è¦å°†æ’ä»¶ç«¯ä¹Ÿå‡çº§åˆ° 2.9.0+ å—ï¼Ÿ

**ç­”**ï¼šæˆ‘ä»¬å»ºè®®æœåŠ¡ç«¯å’Œæ’ä»¶ç«¯çš„ç‰ˆæœ¬ä¸€è‡´ï¼Œå¯ä»¥åŒæ­¥å‡çº§åˆ° 2.9.0ã€‚

åªè¦æ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æ²¡æœ‰å‘ç°éƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸ï¼Œæ— æ³•ä½¿ç”¨ï¼Œæ¥å£ 404 ç­‰æƒ…å†µä¸‹ï¼Œæ’ä»¶ç«¯ä¸åŠæ—¶æ›´æ–°ä¹Ÿæ˜¯æ²¡æœ‰å¤ªå¤šé—®é¢˜çš„ã€‚

æ’ä»¶ç«¯å’ŒæœåŠ¡ç«¯ç‰ˆæœ¬å·®å¼‚è¯·å°½é‡ä¸€è‡´æˆ–è€…ç¼©å°ï¼Œé¿å…å‡ºç°éƒ¨åˆ†åŠŸèƒ½è°ƒæ•´åå…³è”å½±å“ã€‚

### é—®ï¼šå“ªé‡Œä¸‹è½½ 2.8.24+ å®‰è£…åŒ…ï¼Ÿ

**ç­”**ï¼š[https://gitee.com/dromara/Jpom/attach_files](https://gitee.com/dromara/Jpom/attach_files)

### é—®ï¼šæ’ä»¶ç«¯è¯¥å¦‚ä½•å‡çº§åˆ° 2.9.0+ ?

**ç­”**ï¼šæ’ä»¶ç«¯è¿˜æ˜¯å¯ä»¥ä½¿ç”¨ä»¥å‰åˆ°æ–¹å¼ï¼šæ‰‹åŠ¨ä¸Šä¼  jarï¼Œåœ¨çº¿å‡çº§ç­‰ã€‚æ¨èä½¿ç”¨åœ¨çº¿å‡çº§ï¼Œå¯ä»¥åœ¨æœåŠ¡ç«¯é¡µé¢æ‰¹é‡å‡çº§æ’ä»¶ç«¯ç‰ˆæœ¬